<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>LINE送信用フォーム</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    label { display: inline-block; width: 120px; }
    input, button { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>参加確認フォーム</h2>
  <form id="lineForm">
    <div>
      <label for="name">氏名：</label>
      <input type="text" id="name" name="name" required>
    </div>
    <div>
      <label for="date">回答可能時期：</label>
      <input type="date" id="date" name="date" required>
    </div>
    <div>
      <label>現在の意向：</label>
      <input type="radio" id="participate" name="intention" value="参加予定" required>
      <label for="participate">参加予定</label>
      <input type="radio" id="notParticipate" name="intention" value="不参加予定">
      <label for="notParticipate">不参加予定</label>
    </div>
    <div>
      <button type="button" onclick="submitForm()">次へ進む</button>
    </div>
  </form>

  <script>
    // 本日の日付を取得してフォーマットする関数
    function formatDate(dateObj) {
      const yyyy = dateObj.getFullYear();
      const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
      const dd = String(dateObj.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    }

    // 日付入力の最小値（本日）と最大値（今年または来年の5月3日）を設定
    (function setDateLimits() {
      const today = new Date();
      const minDate = formatDate(today);
      document.getElementById("date").setAttribute("min", minDate);

      // 5月3日の設定（JavaScriptでは月は0～11なので5月は4）
      let maxYear = today.getFullYear();
      // もし本日が今年の5月3日より後なら、来年の5月3日に設定
      if (today > new Date(maxYear, 4, 3)) {
        maxYear++;
      }
      const maxDate = `${maxYear}-05-03`;
      document.getElementById("date").setAttribute("max", maxDate);
    })();

    function submitForm() {
      // 入力値の取得
      var name = document.getElementById("name").value.trim();
      var date = document.getElementById("date").value;
      var intentionElements = document.getElementsByName("intention");
      var intention = "";
      for (var i = 0; i < intentionElements.length; i++) {
        if (intentionElements[i].checked) {
          intention = intentionElements[i].value;
          break;
        }
      }
      
      // 入力内容のチェック（未入力なら中断）
      if (!name || !date || !intention) {
        alert("すべての項目に入力・選択してください。");
        return;
      }
      
      // フォーム入力の値を結合してメッセージ文字列を作成
      var message = "氏名：" + name + "\n回答可能時期：" + date + "\n現在の意向：" + intention;
      
      // URLに付加できるようにエンコード（※URLデコードではなくエンコードして整合性を保ちます）
      var encodedMessage = encodeURIComponent(message);
      
      // 基本のURLにエンコードした文字列を付加
      var baseURL = "https://line.me/R/oaMessage/%40069urbrx/";
      var finalURL = baseURL + encodedMessage;
      
      // ポップアップでメッセージ表示
      alert("そのままLINEで送信してください");
      
      // 生成したURLへリダイレクト
      window.location.href = finalURL;
    }
  </script>
</body>
</html>
